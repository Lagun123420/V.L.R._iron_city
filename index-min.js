var renderer=new THREE.WebGLRenderer({antialias:!0});function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}renderer.setSize(window.innerWidth,window.innerHeight),window.innerWidth>800&&(renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.shadowMap.needsUpdate=!0),document.body.appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1);var camera=new THREE.PerspectiveCamera(20,window.innerWidth/window.innerHeight,1,500);function updateCameraPosition(){window.innerWidth<600?camera.position.set(0,2,16):camera.position.set(0,2,14)}updateCameraPosition(),window.addEventListener("resize",updateCameraPosition,!1);var scene=new THREE.Scene,city=new THREE.Object3D,smoke=new THREE.Object3D,town=new THREE.Object3D,createCarPos=!0,uSpeed=.001,setColor=921270;function mathRandom(e=8){return-Math.random()*e+Math.random()*e}scene.background=new THREE.Color(setColor),scene.fog=new THREE.Fog(setColor,10,16);var setTintNum=!0;function setTintColor(){if(setTintNum){setTintNum=!1;var e=0}else{setTintNum=!0;e=0}return e}function init(){for(var e=1;e<100;e++){var t=new THREE.BoxGeometry(1,0,0,2,2,2),n=new THREE.MeshStandardMaterial({color:setTintColor(),wireframe:!1,flatShading:!1,side:THREE.DoubleSide}),o=(new THREE.MeshLambertMaterial({color:16777215,wireframe:!0,transparent:!0,opacity:.03,side:THREE.DoubleSide}),new THREE.Mesh(t,n)),i=(new THREE.Mesh(t,n),new THREE.Mesh(t,n)),a=new THREE.Mesh(t,n);o.add(a),o.setShadow=!0,o.receiveShadow=!0,o.rotationValue=.1+Math.abs(mathRandom(8)),i.scale.y=.05,o.scale.y=.1+Math.abs(mathRandom(8));o.scale.x=o.scale.z=.9+mathRandom(1-.9),o.position.x=Math.round(mathRandom()),o.position.z=Math.round(mathRandom()),i.position.set(o.position.x,0,o.position.z),town.add(i),town.add(o)}for(var r=new THREE.MeshToonMaterial({color:16776960,side:THREE.DoubleSide}),d=new THREE.CircleGeometry(.01,3),s=1;s<300;s++){var h=new THREE.Mesh(d,r);h.position.set(mathRandom(5),mathRandom(5),mathRandom(5)),h.rotation.set(mathRandom(),mathRandom(),mathRandom()),smoke.add(h)}new THREE.MeshStandardMaterial({color:0,side:THREE.DoubleSide,opacity:.9,transparent:!0,roughness:.5,metalness:.5});var c=new THREE.PlaneGeometry(60,60),w=new THREE.Mesh(c,new THREE.MeshPhongMaterial({color:0,side:THREE.DoubleSide,opacity:.9,transparent:!0}));w.rotation.x=-90*Math.PI/180,w.position.y=-.001,w.receiveShadow=!0,city.add(w)}var INTERSECTED,intersected,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2;function onMouseMove(e){e.preventDefault(),mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1}var touchSensitivity=1;function onDocumentTouchStart(e){1==e.touches.length&&(e.preventDefault(),mouse.x=(e.touches[0].pageX/window.innerWidth*2-1)*touchSensitivity,mouse.y=-(e.touches[0].pageY/window.innerHeight*2-1)*touchSensitivity)}function onDocumentTouchMove(e){1==e.touches.length&&(e.preventDefault(),mouse.x=(e.touches[0].pageX/window.innerWidth*2-1)*touchSensitivity,mouse.y=-(e.touches[0].pageY/window.innerHeight*2-1)*touchSensitivity)}window.addEventListener("mousemove",onMouseMove,!1),window.addEventListener("touchstart",onDocumentTouchStart,{passive:!1}),window.addEventListener("touchmove",onDocumentTouchMove,{passive:!1});var ambientLight=new THREE.AmbientLight(10027008,4),lightFront=new THREE.SpotLight(16777215,10,10),lightBack=new THREE.PointLight(10027008,.5),spotLightHelper=new THREE.SpotLightHelper(lightFront);lightFront.rotation.x=45*Math.PI/180,lightFront.rotation.z=-45*Math.PI/180,lightFront.position.set(5,5,5),lightFront.castShadow=!0,lightFront.shadow.mapSize.width=1e3,lightFront.shadow.mapSize.height=lightFront.shadow.mapSize.width,lightFront.penumbra=.1,lightBack.position.set(0,6,0),smoke.position.y=2,scene.add(ambientLight),city.add(lightFront),scene.add(lightBack),scene.add(city),city.add(smoke),city.add(town);var gridHelper=new THREE.GridHelper(60,120,255,1052688);city.add(gridHelper);var createCars=function(e=2,t=20,n=16771496){var o=new THREE.MeshToonMaterial({color:n,side:THREE.DoubleSide}),i=new THREE.BoxGeometry(1,e/40,e/40),a=new THREE.Mesh(i,o);createCarPos?(createCarPos=!1,a.position.x=-t,a.position.z=mathRandom(3),TweenMax.to(a.position,3,{x:t,repeat:-1,yoyo:!0,delay:mathRandom(3)})):(createCarPos=!0,a.position.x=mathRandom(3),a.position.z=-t,a.rotation.y=90*Math.PI/180,TweenMax.to(a.position,5,{z:t,repeat:-1,yoyo:!0,delay:mathRandom(3),ease:Power1.easeInOut})),a.receiveShadow=!0,a.castShadow=!0,a.position.y=Math.abs(mathRandom(5)),city.add(a)},generateLines=function(){for(var e=0;e<60;e++)createCars(.1,20)},cameraSet=function(){createCars(.1,20,16777215)},animate=function(){Date.now();requestAnimationFrame(animate);city.rotation.y-=(8*mouse.x-camera.rotation.y)*uSpeed,city.rotation.x+=(2*mouse.y-camera.rotation.x)*uSpeed,city.rotation.x<-.05?city.rotation.x=-.05:city.rotation.x>1&&(city.rotation.x=1);Math.sin(Date.now()/5e3);for(let e=0,t=town.children.length;e<t;e++)town.children[e];smoke.rotation.y+=.01,smoke.rotation.x+=.01,camera.lookAt(city.position),renderer.render(scene,camera)};generateLines(),init(),animate();